# 6장 다양한 연관관계 매핑

## 복습: 연관관계 매핑시 고려할 점

### 1. 다중성

두 엔티티가 연관관계를 맺는다면, 가능한 관계는 다음과 같다.

* 다대일 (ManyToOne)
* 일대다 (OneToMany)
* 일대일 (OneToOne)
* 다대다 (ManyToMany)

보통은 다대일(일대다) 관계가 많고, 다대다 관계는 거의 사용되지 않는다.  
우선 어떤 관계를 맺고 있는지를 고려해야 할 것이다.

### 2. 단방향/양방향

데이터베이스 상에서 두 엔티티는 외래키로 연결되므로 방향성이라는 것을 
생각할 필요가 없다. 그러나 자바 객체로 매핑한 경우, 한 객체의 필드에
연관관계에 있는 객체의 주소값을 저장하여 참조하기 때문에 방향성을
고려할 필요가 있다.

즉, 각 객체 A와 B가 연관관계에 있는 경우, A에서 B 혹은 B에서 A의
한 가지 방향으로만 참조가 가능하게 할 것인지, 아니면 서로 참조할 수 
있도록 할 것인지 선택해야 한다는 것이다.

### 3. 연관관계의 주인

엔티티를 양방향으로 매핑하려면 연관관계의 주인을 지정할 필요가 있다. 
엔티티를 양방향으로 매핑하게 되면, 우리가 의도한 대로 각 엔티티가
서로를 참조하면서 관계가 이중으로 표현된다. 이것은 조회를 할 때에는 
편리하지만 새로운 엔티티를 만들어 새로운 연관관계를 맺게 하거나,
기존의 연관관계를 수정해야 하는 경우 한 가지 문제를 낳는다.

어떤 엔티티가 연관관계를 관리하게 할 것인가? -> 왜래키 관리의 모호성

이러한 모호함을 해결하기 위해 JPA에서는 연관관계의 주인이 되는 
엔티티를 정하고, 해당 엔티티에서 연관관계를 관리하게 한다. 연관관계의 
주인이 아닌 엔티티의 객체에 어노테이션을 적용할 때 mappedBy 속성을 
사용하여 연관관계의 주인이 참조하는 필드를 지정해주면 된다.

주의할 점은 객체의 책임과 역할 측면에서 주종을 따져서 연관관계의 주인을 
따지는 것이 아니라는 점이다. 외래키를 가지고 있는 테이블에 매핑된 
엔티티를 연관관계의 주인으로 하는 것이 효율적이다.

연관관계의 주인 개념과 이 개념을 알아야하는 이유는 교재 pp. 181-193에서
자세히 다루고 있으며, 다음의 영상을 참고하면 직관적으로 이해하는데 
도움이 된다.

[백기선, 이 문제 답 모르면 제발 JPA 쓰지 마세요. 공부를 하거나. feat 서연](https://www.youtube.com/watch?v=brE0tYOV9jQ)  
[백기선, JPA, OneToMany 양방향 관계 "MappedBy" 해설](https://www.youtube.com/watch?v=hsSc5epPXDs)

## 다대일

### 다대일 단방향

### 다대일 양방향

## 일대다

### 일대다 단방향

### 일대다 양방향

## 일대일

### 주 테이블에 대상 테이블의 외래키가 있는 경우

### 대상 테이블에 주 테이블의 외래키가 있는 경우

## 다대다


